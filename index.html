<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 11 February 2007), see www.w3.org" />
  <link rel="Edit-Time-Data" href="index_files/editdata.mso" />
  <link rel="themeData" href="index_files/themedata.xml" />
  <title></title>
  <style type="text/css">

    body { background-color: #eeeeee;
        margin: 0;
        padding: 0px;
        font-family: "Helvetica Neue", Arial;
        font-weight: lighter;
        font-size: 16px; }

    form.collection-selector { display: inline-block; padding-right: 20px;}

    .date { display: inline-block;
        width: 165px; }
    .time { display: inline-block;
        width: 120px; }
    .date_option { display: inline-block;
        width: 40px;}
    .last { padding-bottom: 20px;}
    #opmerking {
        font-style:italic;
        font-size: 15px;
    }

    #content {
        margin: 5em auto;
        padding: 3em 3em;
        background-color: #ffffff;
        -webkit-box-shadow: 0px 0px 15px 0px rgba(00, 00, 00, 1);
        -moz-box-shadow: 0px 0px 15px 0px rgba(00, 00, 00, 1);
        box-shadow: 0px 0px 15px 0px rgba(00, 00, 00, 1);
        overflow: auto;
    }

    #content h1{
        margin: 0 0 1em;
    }

    #mapArea {
        position:relative;
        float:left;
        width:500px;
        height:500px;
        border:1px dashed black;
        margin-right: 3em;
    }

    .attributes {
        width: 110px;
    }

</style>
</head>

<body>
<div id="content">
	<div id="mapArea"></div>
    <div id="rest">



	<form class="collection-selector">
        <h2>Analyse</h2>
        <h3>Rastergrootte:</h3>
        <input id="rasterSize" type="text" name="raster-size" />
        <h3>Datasets en attributen:</h3>
        <div>
            <select id="collections1" class="collections"><option value="">-</option></select>
            <select id="attributes1-1" class="attributes collections1"><option value="">-</option></select>
            <select id="attributes1-2" class="attributes collections1"><option value="">-</option></select>
            <select id="attributes1-3" class="attributes collections1"><option value="">-</option></select>
            <select id="attributes1-4" class="attributes collections1"><option value="">-</option></select>
            <select id="attributes1-5" class="attributes collections1"><option value="">-</option></select>
        </div>
        <div>
            <select id="collections2" class="collections"><option value="">-</option></select>
            <select id="attributes2-1" class="attributes collections2"><option value="">-</option></select>
            <select id="attributes2-2" class="attributes collections2"><option value="">-</option></select>
            <select id="attributes2-3" class="attributes collections2"><option value="">-</option></select>
            <select id="attributes2-4" class="attributes collections2"><option value="">-</option></select>
            <select id="attributes2-5" class="attributes collections2"><option value="">-</option></select>
        </div>
        <div>
            <select id="collections3" class="collections"><option value="">-</option></select>
            <select id="attributes3-1" class="attributes collections3"><option value="">-</option></select>
            <select id="attributes3-2" class="attributes collections3"><option value="">-</option></select>
            <select id="attributes3-3" class="attributes collections3"><option value="">-</option></select>
            <select id="attributes3-4" class="attributes collections3"><option value="">-</option></select>
            <select id="attributes3-5" class="attributes collections3"><option value="">-</option></select>
        </div>

        <input type="button" id="start-analyzer" value="Analyseer">
	</form>
    <div id="debug">...</div><br />
    </div>
    <h2>Nieuwe set uploaden</h2>
    <form enctype="multipart/form-data" action="scripts/upload-file.py" method=post>
        <p>Collectie naam:<input type="text" name="collection"></p>
        <p>Shapefile: <input type="file" name="shp"></p>
        <p>Dbf file: <input type="file" name="dbf"></p>
        <p><input type=submit value="Uploaden">
    </form>
    <div id="associations-results">
        <p>Hier komen de verbanden:</p>
    </div>
</div><!-- content -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">

var map;

window.onload = function(){

	var my_resolution = 100;
	var my_radius = 10;
	var my_opacity = 70;

	var myLatlng = new google.maps.LatLng(51.9209866008, 4.47188401315);
	var myOptions = {
	  zoom: 15,
	  center: myLatlng,
	  mapTypeId: google.maps.MapTypeId.ROADMAP,
	  disableDefaultUI: false,
	  scrollwheel: true,
	  draggable: true,
	  navigationControl: true,
	  mapTypeControl: false,
	  scaleControl: true,
	  disableDoubleClickZoom: false
	};
	map = new google.maps.Map(document.getElementById("mapArea"), myOptions);

    var clearSelect = function(selectElement){
        $("."+($(selectElement).attr('id'))).find('option')
                .remove()
                .end()
                .append('<option value="">-</option>')
                .val('whatever');
    }

    // Adds an function to the analyze button to do something real.
    $("#start-analyzer").click(function() {
        // The request url.
        var url = "scripts/analyze.py?bounds=" + map.getBounds() + "";

        // We store what data sets and attributes are selected
        var dataSets = [];
        var setAttributen = []; // Stores arrays with attributes

        // Check each data set select-field.
        $(".collection-selector").find(".collections option:selected").each(function(i, v){
            // Check if the value of a data set is not equal to '-'.
            if($(this).text() != "-") {
                // Check if the set is not selected before
                if(jQuery.inArray($(this).text(), dataSets) == -1) {
                    var selector = ".attributes." + $(this).parent().attr("id") + " option:selected";
                    var attributes = [];    // For a single data set

                    // Store each selected attribute
                    $(selector).each(function(j, w) {
                        if($(this).text() != "-") {
                            if(jQuery.inArray($(this).text(), attributes) == -1) {
                                attributes.push($(this).text());
                            }
                        }
                    });

                    // Store the data set and it attributes only if at least one attributes was selected, .
                    if($(attributes).size() > 0) {
                        dataSets.push($(this).text());
                        setAttributen.push(attributes);
                    }
                }
            }
        });

        // Kijk of er een geldige selectie van data sets (en attributen) is.
        if($(dataSets).size() > 0) {
            // Generate data set call
            var setCall = "{"
            $.each(dataSets, function(index, value) {
                var attrCal = "[";
                $.each(setAttributen[index], function (index, value) {
                    if(index != 0) {
                        attrCal += ", ";
                    }
                    attrCal += "\"" + value + "\"";
                });
                attrCal += "]";
                if(index != 0) {
                    setCall += ", "
                }
                setCall += "\"" + value + "\": " + attrCal;
            });
            setCall += "}";
            url += "&sets=" + setCall;

            // Generate rasterSize option
            if($.isNumeric($("#rasterSize").val())) {
                url += "&rasterSize=" + $("#rasterSize").val();
            } else {
                url += "&rasterSize=10";
            }
            $.ajax({ url: url }).done(
                    function (data) {
                        $("#associations-results").html(data);
                    }
            );
        } else {
            $("#associations-results").html("Geen geldige selectie van data set(s) en attributen.");
        }
    });

    $.ajax({ url: "scripts/find_collections.py" }).done(
            function( msg ) {
                var options = $("select.collections");
                var coll_array = eval(msg);
                for (var i = 0; i < coll_array.length; i++) {
                    options.append($("<option />").val(coll_array[i]).text(coll_array[i]));
                }
                $(".collections").change(function(){
                    if ($(this).val() != ""){
                        var selector = this;
	                    var set = $("option:selected", this).text();
                        $.ajax({ url: "scripts/load_attributes.py?set="+set }).done(
                                function( response ){
                                    var att_array = eval(response);
                                    if (att_array == undefined ){
                                        clearSelect(selector);
                                    } else {
                                        clearSelect(selector);
                                        var selects = $("."+($(selector).attr("id")));
                                        for (var i = 0; i < att_array.length; i++) {
                                            selects.append($("<option />").val(att_array[i]).text(att_array[i]));
                                        }
                                    }

                                }
                        );
	                } else {
	                	clearSelect(this);
	                }
	            });

//                $('#collections1 :nth-child(2)').attr('selected', 'selected')

            });

};

</script>
</body>
</html>
